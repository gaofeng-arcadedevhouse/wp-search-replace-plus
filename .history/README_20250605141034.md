# WorldTeam Search & Replace WordPress Plugin

一个强大的WordPress内容搜索替换工具，支持Posts、Pages、ACF字段和PHP模板文件的批量搜索替换功能。

## 功能特性

### 核心功能
- **全面搜索支持**：
  - WordPress文章和页面内容
  - ACF (Advanced Custom Fields) 字段
  - 自定义字段 (Custom Fields)
  - 评论内容
  - 主题PHP文件
  - 插件PHP文件

- **安全机制**：
  - 自动备份功能
  - 操作确认机制
  - 权限验证（仅管理员可用）
  - 操作日志记录

- **灵活搜索选项**：
  - 区分大小写搜索
  - 正则表达式支持
  - 完整单词匹配
  - 实时预览替换结果

- **用户友好界面**：
  - 直观的管理界面
  - 批量选择和操作
  - 进度条显示
  - 详细的操作反馈

## 技术架构

### 文件结构
```
worldteam-search-replace/
├── worldteam-search-replace.php          # 主插件文件
├── includes/                             # PHP类文件
│   ├── admin-page.php                   # 管理页面HTML
│   ├── class-search-handler.php         # 搜索处理器
│   ├── class-database-handler.php       # 数据库操作
│   ├── class-file-scanner.php           # 文件系统扫描
│   ├── class-replace-handler.php        # 替换操作处理
│   └── class-backup-handler.php         # 备份管理
├── assets/                              # 静态资源
│   ├── css/
│   │   └── admin.css                    # 管理界面样式
│   └── js/
│       └── admin.js                     # 前端交互逻辑
└── README.md                            # 说明文档
```

### 核心类设计

1. **WorldTeamSearchReplace** - 主插件类
   - 插件初始化和钩子注册
   - AJAX请求路由
   - 权限控制

2. **WTSR_Search_Handler** - 搜索处理器
   - 统一搜索接口
   - 结果格式化
   - 预览生成

3. **WTSR_Database_Handler** - 数据库操作
   - WordPress数据库搜索
   - ACF字段支持
   - 数据库更新操作

4. **WTSR_File_Scanner** - 文件系统扫描
   - 主题和插件文件搜索
   - 文件内容替换
   - 文件备份管理

5. **WTSR_Replace_Handler** - 替换操作处理
   - 批量替换协调
   - 操作验证
   - 日志记录

6. **WTSR_Backup_Handler** - 备份管理
   - 数据库备份
   - 文件备份
   - 备份恢复

## 安装说明

### 系统要求
- WordPress 5.0 或更高版本
- PHP 7.4 或更高版本
- MySQL 5.6 或更高版本
- 足够的磁盘空间用于备份文件

### 安装步骤

1. **下载插件**
   ```bash
   # 克隆或下载插件文件到WordPress插件目录
   cd /path/to/wordpress/wp-content/plugins/
   git clone [repository-url] worldteam-search-replace
   ```

2. **设置权限**
   ```bash
   # 确保WordPress有读写权限
   chown -R www-data:www-data worldteam-search-replace/
   chmod -R 755 worldteam-search-replace/
   ```

3. **激活插件**
   - 登录WordPress管理后台
   - 进入"插件"页面
   - 找到"WorldTeam Search & Replace"
   - 点击"激活"

4. **首次使用**
   - 激活后会自动创建必要的数据库表
   - 在"工具" → "搜索替换"中访问插件

## 使用指南

### 基本搜索操作

1. **设置搜索参数**
   - 输入要搜索的文本
   - 选择搜索范围（数据库内容/文件系统）
   - 配置搜索选项（大小写敏感/正则表达式等）

2. **执行搜索**
   - 点击"开始搜索"按钮
   - 等待搜索完成
   - 查看搜索结果列表

3. **预览和选择**
   - 查看每个匹配项的详细信息
   - 点击展开查看完整内容
   - 选择需要替换的项目

### 替换操作

1. **输入替换文本**
   - 在"替换文本"框中输入新内容
   - 留空表示删除匹配的文本

2. **选择替换项目**
   - 使用复选框选择单个项目
   - 或使用"全选"/"取消全选"批量操作

3. **执行替换**
   - 点击"替换选中项"按钮
   - 确认操作详情
   - 等待替换完成

### 备份管理

1. **创建备份**
   - 点击"创建备份"按钮
   - 系统会自动创建完整数据库备份
   - 备份文件存储在安全目录中

2. **自动备份**
   - 执行替换操作时会自动创建备份
   - 文件替换会创建单独的文件备份

## 安全注意事项

### 权限控制
- 仅WordPress管理员可以使用此插件
- 所有操作都经过nonce验证
- 文件操作限制在WordPress目录内

### 备份建议
- 在执行大量替换前手动创建完整备份
- 定期清理旧备份文件以节省空间
- 重要操作前建议额外创建服务器级备份

### 操作验证
- 替换前仔细检查搜索结果
- 使用预览功能确认替换效果
- 避免在关键系统文件中进行替换

## 常见使用场景

### 1. 域名更换
```
搜索: https://old-domain.com
替换: https://new-domain.com
范围: Posts, Pages, ACF字段
```

### 2. 联系信息更新
```
搜索: old-email@example.com
替换: new-email@example.com
范围: Posts, Pages, 评论
```

### 3. 代码重构
```
搜索: old_function_name
替换: new_function_name
范围: 主题文件, 插件文件
```

### 4. 内容批量修正
```
搜索: 错误的公司名称
替换: 正确的公司名称
范围: 所有内容类型
```

## 故障排除

### 常见问题

1. **搜索结果为空**
   - 检查搜索文本是否正确
   - 确认已选择正确的搜索范围
   - 验证搜索选项设置

2. **替换操作失败**
   - 检查文件写入权限
   - 确认数据库连接正常
   - 查看错误日志获取详细信息

3. **备份创建失败**
   - 检查磁盘空间是否充足
   - 验证backup目录写入权限
   - 确认数据库访问权限

### 性能优化

1. **大量数据处理**
   - 分批次进行替换操作
   - 避免在高峰时段执行大量操作
   - 考虑增加PHP内存限制和执行时间

2. **文件操作优化**
   - 排除不必要的文件类型
   - 限制搜索深度和范围
   - 定期清理备份文件

## 开发和定制

### 扩展功能
插件采用模块化设计，便于扩展：

1. **添加新的搜索范围**
   - 创建新的处理器类
   - 实现搜索和替换方法
   - 在主控制器中注册

2. **自定义备份策略**
   - 扩展WTSR_Backup_Handler类
   - 实现特定的备份逻辑
   - 添加恢复功能

3. **界面定制**
   - 修改admin-page.php模板
   - 调整CSS样式
   - 扩展JavaScript功能

### 钩子和过滤器
插件提供了多个钩子供开发者使用：

```php
// 在搜索前执行自定义逻辑
add_action('wtsr_before_search', 'custom_search_handler');

// 过滤搜索结果
add_filter('wtsr_search_results', 'custom_result_filter');

// 在替换前验证
add_filter('wtsr_validate_replace', 'custom_validation');
```

## 更新日志

### Version 1.0.0
- 初始版本发布
- 基础搜索替换功能
- 数据库和文件系统支持
- 备份和恢复功能
- 安全机制实现

## 支持和反馈

如有问题或建议，请通过以下方式联系：

- 项目地址：[GitHub Repository]
- 技术支持：[support@worldteam.com]
- 文档更新：[docs.worldteam.com]

## 许可证

本插件采用GPL v2或更高版本许可证发布。

---

**重要提醒**：在生产环境中使用前，请务必在测试环境中充分测试所有功能，并创建完整的站点备份。 